<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Supabase Storage åˆ—å‡ºæª”æ¡ˆ</title>
</head>
<body>
  <div id="app">
    <h2>Bucketï¼š{{ bucket }} / è³‡æ–™å¤¾ï¼š{{ folder || '(æ ¹ç›®éŒ„)' }}</h2>

    <div v-if="loading">è®€å–ä¸­...</div>
    <div v-else-if="error" style="color:red">{{ error }}</div>

    <ul v-else>
      <li v-for="file in files" :key="file.path" style="margin-bottom: 16px;">
        <strong>{{ file.name }}</strong>
        <div>å®Œæ•´è·¯å¾‘ï¼š{{ file.path }}</div>

        <div v-if="file.url" style="margin-top: 8px;">
          <img :src="file.url" style="max-width: 200px; border: 1px solid #ccc;" />
        </div>
      </li>
    </ul>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- 3ï¸âƒ£ æœ€å¾Œæ‰æ˜¯ä½ çš„ç¨‹å¼ -->
  <script>
    // ğŸ”§ æ›æˆä½ è‡ªå·±çš„ Supabase å°ˆæ¡ˆè¨­å®š
    const supabaseUrl = 'https://rvntujioqkontqqjhxdb.supabase.co';
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2bnR1amlvcWtvbnRxcWpoeGRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5MjkwNTMsImV4cCI6MjA3NTUwNTA1M30.YGPpQFss05qu3YmmHvnmfJycmhbQDTSKlzDz25Gbg6c';


    // âœ… é€™è£¡å»ºç«‹ä¸€å€‹ã€Œå…¨åŸŸå¯ç”¨ã€çš„ Supabase client
    // CDN ç‰ˆæœ¬æœƒæä¾›å…¨åŸŸç‰©ä»¶ `supabase`
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey)

    new Vue({
      el: '#app',
      data: {
        bucket: 'aipri', // æ”¹æˆä½ çš„ bucket åç¨±
        folder: 'main',    // æ ¹ç›®éŒ„å°±æ”¹æˆ ''ï¼Œå­è³‡æ–™å¤¾å°± 'images' æˆ–å…¶ä»–
        files: [],
        loading: false,
        error: ''
      },
      mounted () {
        this.fetchFiles()
      },
      methods: {
        async fetchFiles () {
          this.loading = true
          this.error = ''
          this.files = []

          const folderPath = this.folder || '' // æ ¹ç›®éŒ„å°±ç”¨ç©ºå­—ä¸²

          // 1ï¸âƒ£ ç”¨ supabaseClientï¼Œè€Œä¸æ˜¯ client
          const { data, error } = await supabaseClient
            .storage
            .from(this.bucket)
            .list(folderPath, {
              limit: 100,
              offset: 0,
              sortBy: { column: 'name', order: 'asc' }
            })

          if (error) {
            console.error('è®€å–å¤±æ•—ï¼š', error)
            this.error = 'è®€å–å¤±æ•—ï¼š' + error.message
            this.loading = false
            return
          }

          // 2ï¸âƒ£ æŠŠæ¯å€‹æª”æ¡ˆè½‰æˆ publicUrl
          this.files = data.map(file => {
            const path = (folderPath ? folderPath + '/' : '') + file.name

            const { data: urlData } = supabaseClient
              .storage
              .from(this.bucket)
              .getPublicUrl(path)

            return {
              name: file.name,
              path,
              url: urlData.publicUrl
            }
          })

          this.loading = false
        }
      }
    })
  </script>
</body>
</html>
